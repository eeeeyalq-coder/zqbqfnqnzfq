<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin ‚Äî NovaPlay</title>
    <link rel="icon" href="favicon.ico">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* ===================== ADMIN RESET ===================== */
        .admin-page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* ===================== TOAST ===================== */
        #toastContainer {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: .65rem;
            pointer-events: none;
        }

        .toast {
            display: flex;
            align-items: center;
            gap: .75rem;
            padding: .85rem 1.25rem;
            border-radius: 12px;
            backdrop-filter: blur(20px);
            font-size: .9rem;
            font-weight: 600;
            pointer-events: auto;
            animation: toastIn .35s cubic-bezier(.34, 1.56, .64, 1) both;
            min-width: 260px;
            max-width: 380px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, .4);
        }

        .toast.success {
            background: rgba(34, 197, 94, .15);
            border: 1px solid rgba(34, 197, 94, .35);
            color: #86efac;
        }

        .toast.error {
            background: rgba(239, 68, 68, .15);
            border: 1px solid rgba(239, 68, 68, .35);
            color: #fca5a5;
        }

        .toast.info {
            background: rgba(139, 92, 246, .15);
            border: 1px solid rgba(139, 92, 246, .35);
            color: #c4b5fd;
        }

        .toast .toast-icon {
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .toast.hide {
            animation: toastOut .3s ease forwards;
        }

        @keyframes toastIn {
            from {
                opacity: 0;
                transform: translateX(60px) scale(.9);
            }

            to {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }

        @keyframes toastOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }

            to {
                opacity: 0;
                transform: translateX(60px);
            }
        }

        /* ===================== LOGIN SCREEN ===================== */
        .login-screen {
            display: none;
            flex: 1;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            background:
                radial-gradient(ellipse 70% 60% at 20% 30%, rgba(139, 92, 246, .12) 0%, transparent 60%),
                radial-gradient(ellipse 50% 50% at 80% 70%, rgba(99, 102, 241, .1) 0%, transparent 60%);
        }

        .login-screen.active {
            display: flex;
        }

        .login-card {
            width: 100%;
            max-width: 440px;
            background: linear-gradient(145deg, rgba(25, 20, 45, .92), rgba(12, 10, 22, .97));
            border: 1px solid rgba(139, 92, 246, .3);
            border-radius: 24px;
            padding: 2.75rem 2.5rem 2.25rem;
            box-shadow: 0 0 0 1px rgba(139, 92, 246, .1), 0 30px 80px rgba(0, 0, 0, .55), 0 0 100px -20px rgba(139, 92, 246, .35);
            position: relative;
            overflow: hidden;
            animation: fadeUp .5s cubic-bezier(.4, 0, .2, 1) both;
        }

        .login-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--accent-violet), var(--accent-light), var(--accent-cyan), transparent);
        }

        /* Subtle grid texture */
        .login-card::after {
            content: '';
            position: absolute;
            inset: 0;
            background-image: repeating-linear-gradient(0deg, transparent, transparent 40px, rgba(139, 92, 246, .03) 40px, rgba(139, 92, 246, .03) 41px),
                repeating-linear-gradient(90deg, transparent, transparent 40px, rgba(139, 92, 246, .03) 40px, rgba(139, 92, 246, .03) 41px);
            pointer-events: none;
        }

        .login-logo {
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
            z-index: 1;
        }

        .login-logo .icon-wrap {
            width: 76px;
            height: 76px;
            margin: 0 auto 1rem;
            background: rgba(139, 92, 246, .18);
            border: 1px solid rgba(139, 92, 246, .45);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            box-shadow: 0 0 40px rgba(139, 92, 246, .35), inset 0 0 20px rgba(139, 92, 246, .1);
            transition: box-shadow .3s, transform .3s;
        }

        .login-card.locked .icon-wrap {
            background: rgba(239, 68, 68, .15);
            border-color: rgba(239, 68, 68, .4);
            box-shadow: 0 0 40px rgba(239, 68, 68, .3), inset 0 0 20px rgba(239, 68, 68, .08);
        }

        .login-logo h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, #fff, var(--accent-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-logo p {
            color: var(--text-muted);
            font-size: .85rem;
            margin-top: .35rem;
        }

        /* Attempt dots */
        .attempt-dots {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-top: .75rem;
        }

        .attempt-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, .12);
            border: 1px solid rgba(255, 255, 255, .15);
            transition: background .3s, border-color .3s, transform .3s;
        }

        .attempt-dot.used {
            background: rgba(239, 68, 68, .7);
            border-color: rgba(239, 68, 68, .9);
            transform: scale(1.15);
        }

        .attempt-dot.last-used {
            animation: dotPop .4s cubic-bezier(.34, 1.56, .64, 1);
        }

        @keyframes dotPop {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.6);
            }

            100% {
                transform: scale(1.15);
            }
        }

        .field-group {
            margin-bottom: 1.25rem;
            position: relative;
            z-index: 1;
        }

        .field-group label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: .78rem;
            color: var(--text-muted);
            margin-bottom: .45rem;
            letter-spacing: .04em;
            text-transform: uppercase;
        }

        .attempts-left-label {
            font-size: .72rem;
            letter-spacing: 0;
            text-transform: none;
            color: rgba(252, 165, 165, .8);
            font-weight: 600;
        }

        .field-input-wrap {
            position: relative;
        }

        .field-input-wrap .fi-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1rem;
            opacity: .5;
            pointer-events: none;
            z-index: 2;
        }

        .field-input-wrap input {
            width: 100%;
            padding: .85rem 3rem .85rem 2.75rem;
            background: rgba(0, 0, 0, .35);
            border: 1px solid rgba(255, 255, 255, .08);
            border-radius: 10px;
            color: #fff;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color .25s, box-shadow .25s;
            outline: none;
            box-sizing: border-box;
        }

        .field-input-wrap input:focus {
            border-color: var(--accent-violet);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, .2);
        }

        .field-input-wrap input.error {
            border-color: rgba(239, 68, 68, .6);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, .15);
        }

        .field-input-wrap input::placeholder {
            color: rgba(255, 255, 255, .22);
        }

        /* Toggle show password */
        .toggle-pass-btn {
            position: absolute;
            right: .75rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            padding: .25rem;
            color: rgba(255, 255, 255, .35);
            font-size: 1.05rem;
            line-height: 1;
            transition: color .2s, opacity .2s;
            z-index: 2;
        }

        .toggle-pass-btn:hover {
            color: rgba(255, 255, 255, .7);
        }

        /* Shake animation */
        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            15% {
                transform: translateX(-8px);
            }

            30% {
                transform: translateX(7px);
            }

            45% {
                transform: translateX(-6px);
            }

            60% {
                transform: translateX(5px);
            }

            75% {
                transform: translateX(-3px);
            }

            90% {
                transform: translateX(2px);
            }
        }

        .shake {
            animation: shake .5s cubic-bezier(.36, .07, .19, .97) both;
        }

        /* Error hint */
        .field-hint {
            font-size: .78rem;
            margin-top: .4rem;
            min-height: 1.1em;
            transition: color .25s;
        }

        .field-hint.err {
            color: #fca5a5;
        }

        .field-hint.ok {
            color: #86efac;
        }

        /* Lockout banner */
        .lockout-banner {
            display: none;
            background: rgba(239, 68, 68, .1);
            border: 1px solid rgba(239, 68, 68, .3);
            border-radius: 10px;
            padding: .8rem 1rem;
            margin-bottom: 1.1rem;
            text-align: center;
            font-size: .88rem;
            color: #fca5a5;
            position: relative;
            z-index: 1;
        }

        .lockout-banner.active {
            display: block;
        }

        .lockout-banner strong {
            display: block;
            font-size: .95rem;
            margin-bottom: .2rem;
        }

        .lockout-timer {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3rem;
            font-weight: 900;
            color: #f87171;
            margin-top: .35rem;
            letter-spacing: .05em;
        }

        .btn-primary {
            width: 100%;
            padding: .95rem;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--accent-violet), var(--accent-dark));
            color: #fff;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: .05em;
            transition: transform .2s, box-shadow .2s, opacity .2s;
            box-shadow: 0 4px 20px rgba(139, 92, 246, .35);
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: .6rem;
            overflow: hidden;
        }

        .btn-primary::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, .08), transparent);
            opacity: 0;
            transition: opacity .25s;
        }

        .btn-primary:hover:not(:disabled)::after {
            opacity: 1;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(139, 92, 246, .5);
        }

        .btn-primary:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn-primary:disabled {
            opacity: .55;
            cursor: not-allowed;
            transform: none;
        }

        /* Spinner inside button */
        .btn-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, .3);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin .7s linear infinite;
            display: none;
            flex-shrink: 0;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .btn-primary.loading .btn-spinner {
            display: block;
        }

        .btn-primary.loading .btn-text {
            opacity: .7;
        }

        /* ===================== MAIN LAYOUT ===================== */
        .admin-layout {
            display: none;
            flex: 1;
            min-height: 100vh;
        }

        .admin-layout.active {
            display: flex;
        }

        /* SIDEBAR */
        .admin-sidebar {
            width: 260px;
            flex-shrink: 0;
            background: rgba(10, 8, 20, .85);
            border-right: 1px solid rgba(255, 255, 255, .06);
            backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
            padding: 1.5rem 1rem;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-brand {
            display: flex;
            align-items: center;
            gap: .75rem;
            padding: .5rem .75rem 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, .06);
            margin-bottom: 1.25rem;
        }

        .sidebar-brand .brand-icon {
            width: 38px;
            height: 38px;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--accent-violet), var(--accent-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            box-shadow: 0 4px 14px rgba(139, 92, 246, .4);
        }

        .sidebar-brand .brand-name {
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            font-size: .95rem;
            background: linear-gradient(135deg, #fff, var(--accent-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sidebar-brand .brand-sub {
            font-size: .7rem;
            color: var(--text-muted);
        }

        .sidebar-nav {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: .3rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: .75rem;
            padding: .7rem 1rem;
            border-radius: 10px;
            cursor: pointer;
            color: var(--text-muted);
            font-size: .88rem;
            font-weight: 500;
            transition: all .2s;
            border: 1px solid transparent;
            background: none;
            font-family: inherit;
            text-decoration: none;
            width: 100%;
            text-align: left;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, .05);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: rgba(139, 92, 246, .15);
            color: var(--accent-light);
            border-color: rgba(139, 92, 246, .25);
            box-shadow: inset 0 0 20px rgba(139, 92, 246, .05);
        }

        .nav-item .ni-icon {
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .nav-item .ni-badge {
            margin-left: auto;
            background: rgba(139, 92, 246, .3);
            color: var(--accent-light);
            font-size: .7rem;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 99px;
        }

        .sidebar-footer {
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, .06);
            display: flex;
            flex-direction: column;
            gap: .5rem;
        }

        .btn-logout {
            display: flex;
            align-items: center;
            gap: .6rem;
            padding: .65rem 1rem;
            border-radius: 10px;
            border: 1px solid rgba(239, 68, 68, .2);
            background: rgba(239, 68, 68, .08);
            color: #fca5a5;
            font-size: .85rem;
            font-weight: 500;
            cursor: pointer;
            font-family: inherit;
            transition: all .2s;
            width: 100%;
        }

        .btn-logout:hover {
            background: rgba(239, 68, 68, .18);
            border-color: rgba(239, 68, 68, .4);
        }

        .btn-back-site {
            display: flex;
            align-items: center;
            gap: .6rem;
            padding: .65rem 1rem;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, .07);
            background: transparent;
            color: var(--text-muted);
            font-size: .85rem;
            cursor: pointer;
            font-family: inherit;
            transition: all .2s;
            width: 100%;
            text-decoration: none;
        }

        .btn-back-site:hover {
            background: rgba(255, 255, 255, .05);
            color: var(--text-primary);
        }

        /* MAIN CONTENT */
        .admin-main {
            flex: 1;
            overflow-y: auto;
            padding: 2rem 2.5rem;
            min-width: 0;
        }

        /* PAGE HEADER */
        .page-hdr {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .page-hdr-left h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.6rem;
            font-weight: 900;
            background: linear-gradient(135deg, #fff, var(--accent-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-hdr-left p {
            color: var(--text-muted);
            font-size: .85rem;
            margin-top: .2rem;
        }

        /* STATS CARDS */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, .03);
            border: 1px solid rgba(255, 255, 255, .07);
            border-radius: 16px;
            padding: 1.25rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: transform .25s, box-shadow .25s;
            position: relative;
            overflow: hidden;
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--stat-color, var(--accent-violet));
            border-radius: 16px 16px 0 0;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, .3);
        }

        .stat-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            flex-shrink: 0;
            background: var(--stat-bg, rgba(139, 92, 246, .15));
            border: 1px solid var(--stat-border, rgba(139, 92, 246, .3));
        }

        .stat-info .stat-val {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.6rem;
            font-weight: 900;
            color: #fff;
            line-height: 1;
        }

        .stat-info .stat-lbl {
            font-size: .75rem;
            color: var(--text-muted);
            margin-top: .25rem;
        }

        /* PANEL SECTIONS */
        .admin-panel {
            background: rgba(255, 255, 255, .02);
            border: 1px solid rgba(255, 255, 255, .07);
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .panel-hdr {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.1rem 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, .06);
            background: rgba(255, 255, 255, .02);
        }

        .panel-hdr-title {
            display: flex;
            align-items: center;
            gap: .65rem;
            font-weight: 700;
            font-size: .95rem;
            color: var(--text-primary);
        }

        .panel-hdr-title .ph-icon {
            font-size: 1.1rem;
        }

        .panel-body {
            padding: 1.5rem;
        }

        /* FORM GRID */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-grid .span2 {
            grid-column: span 2;
        }

        @media (max-width: 700px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .form-grid .span2 {
                grid-column: span 1;
            }
        }

        .form-field {
            display: flex;
            flex-direction: column;
            gap: .4rem;
        }

        .form-field label {
            font-size: .78rem;
            color: var(--text-muted);
            letter-spacing: .04em;
            text-transform: uppercase;
            font-weight: 600;
        }

        .form-field input,
        .form-field select,
        .form-field textarea {
            padding: .7rem .9rem;
            background: rgba(0, 0, 0, .25);
            border: 1px solid rgba(255, 255, 255, .08);
            border-radius: 10px;
            color: #fff;
            font-size: .95rem;
            font-family: inherit;
            transition: border-color .2s, box-shadow .2s;
            outline: none;
            width: 100%;
        }

        .form-field input:focus,
        .form-field select:focus,
        .form-field textarea:focus {
            border-color: var(--accent-violet);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, .2);
        }

        .form-field input::placeholder,
        .form-field textarea::placeholder {
            color: rgba(255, 255, 255, .2);
        }

        .form-field textarea {
            min-height: 90px;
            resize: vertical;
        }

        .form-field select option {
            background: #1a1530;
        }

        .form-field .hint {
            font-size: .75rem;
            color: var(--text-muted);
        }

        .toggle-row {
            display: flex;
            align-items: center;
            gap: .75rem;
            padding: .8rem;
            background: rgba(255, 255, 255, .02);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, .06);
            cursor: pointer;
        }

        .toggle-row input[type=checkbox] {
            display: none;
        }

        .toggle-knob {
            width: 42px;
            height: 24px;
            background: rgba(255, 255, 255, .1);
            border-radius: 99px;
            border: 1px solid rgba(255, 255, 255, .12);
            position: relative;
            flex-shrink: 0;
            transition: background .25s, border-color .25s;
        }

        .toggle-knob::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: rgba(255, 255, 255, .5);
            transition: transform .25s, background .25s;
        }

        input:checked+.toggle-knob {
            background: rgba(139, 92, 246, .5);
            border-color: rgba(139, 92, 246, .6);
        }

        input:checked+.toggle-knob::after {
            transform: translateX(18px);
            background: var(--accent-light);
        }

        .toggle-label {
            font-size: .9rem;
            color: var(--text-secondary);
        }

        .optional-fields {
            border: 1px dashed rgba(139, 92, 246, .25);
            border-radius: 12px;
            padding: 1rem;
            margin-top: .75rem;
            display: none;
        }

        .optional-fields.visible {
            display: flex;
            flex-direction: column;
            gap: .75rem;
        }

        .form-actions {
            display: flex;
            gap: .75rem;
            flex-wrap: wrap;
            margin-top: 1.25rem;
            align-items: center;
        }

        .btn-submit {
            padding: .8rem 2rem;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--accent-violet), var(--accent-dark));
            color: #fff;
            font-size: .9rem;
            font-weight: 700;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: .04em;
            transition: transform .2s, box-shadow .2s;
            box-shadow: 0 4px 20px rgba(139, 92, 246, .3);
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 28px rgba(139, 92, 246, .5);
        }

        .btn-ghost {
            padding: .75rem 1.5rem;
            border: 1px solid rgba(255, 255, 255, .1);
            border-radius: 10px;
            background: transparent;
            color: var(--text-muted);
            font-size: .88rem;
            font-weight: 500;
            cursor: pointer;
            font-family: inherit;
            transition: all .2s;
        }

        .btn-ghost:hover {
            background: rgba(255, 255, 255, .05);
            color: var(--text-primary);
        }

        /* GAMES LIST */
        .games-toolbar {
            display: flex;
            gap: .75rem;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .search-admin {
            flex: 1;
            min-width: 180px;
            padding: .65rem 1rem .65rem 2.5rem;
            background: rgba(0, 0, 0, .25);
            border: 1px solid rgba(255, 255, 255, .08);
            border-radius: 10px;
            color: #fff;
            font-size: .9rem;
            font-family: inherit;
            outline: none;
            transition: border-color .2s, box-shadow .2s;
            position: relative;
        }

        .search-admin:focus {
            border-color: var(--accent-violet);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, .2);
        }

        .search-admin::placeholder {
            color: rgba(255, 255, 255, .25);
        }

        .search-wrap {
            position: relative;
            flex: 1;
            min-width: 180px;
        }

        .search-wrap .s-icon {
            position: absolute;
            left: .8rem;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, .3);
            pointer-events: none;
            font-size: .9rem;
        }

        .filter-pill {
            padding: .55rem 1rem;
            border: 1px solid rgba(255, 255, 255, .08);
            border-radius: 99px;
            background: rgba(255, 255, 255, .03);
            color: var(--text-muted);
            font-size: .8rem;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            transition: all .2s;
            white-space: nowrap;
        }

        .filter-pill.active {
            background: rgba(139, 92, 246, .2);
            border-color: rgba(139, 92, 246, .4);
            color: var(--accent-light);
        }

        .filter-pill:hover {
            border-color: rgba(255, 255, 255, .2);
            color: var(--text-primary);
        }

        .games-table {
            display: flex;
            flex-direction: column;
            gap: .5rem;
        }

        .game-row {
            display: flex;
            align-items: center;
            gap: .85rem;
            padding: .75rem 1rem;
            border-radius: 12px;
            background: rgba(255, 255, 255, .025);
            border: 1px solid rgba(255, 255, 255, .06);
            transition: all .2s;
            position: relative;
        }

        .game-row:hover {
            background: rgba(255, 255, 255, .05);
            border-color: rgba(255, 255, 255, .12);
        }

        .game-row.hidden-game {
            opacity: .5;
        }

        .game-thumb {
            width: 88px;
            height: 50px;
            border-radius: 8px;
            object-fit: cover;
            flex-shrink: 0;
            background: rgba(255, 255, 255, .05);
        }

        .game-thumb-placeholder {
            width: 88px;
            height: 50px;
            border-radius: 8px;
            flex-shrink: 0;
            background: rgba(255, 255, 255, .05);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            color: rgba(255, 255, 255, .2);
        }

        .game-info {
            flex: 1;
            min-width: 0;
        }

        .game-info .g-title {
            font-weight: 700;
            color: var(--text-primary);
            font-size: .9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .game-info .g-meta {
            display: flex;
            align-items: center;
            gap: .5rem;
            margin-top: .2rem;
        }

        .g-badge {
            font-size: .68rem;
            font-weight: 700;
            letter-spacing: .06em;
            text-transform: uppercase;
            padding: 2px 8px;
            border-radius: 99px;
        }

        .g-badge.solo {
            background: rgba(6, 182, 212, .15);
            border: 1px solid rgba(6, 182, 212, .3);
            color: #67e8f9;
        }

        .g-badge.multiplayer {
            background: rgba(139, 92, 246, .15);
            border: 1px solid rgba(139, 92, 246, .3);
            color: var(--accent-light);
        }

        .g-badge.hidden {
            background: rgba(255, 255, 255, .08);
            border: 1px solid rgba(255, 255, 255, .15);
            color: var(--text-muted);
        }

        .g-badge.has-modal {
            background: rgba(34, 197, 94, .1);
            border: 1px solid rgba(34, 197, 94, .25);
            color: #86efac;
        }

        .game-row-actions {
            display: flex;
            gap: .4rem;
            flex-shrink: 0;
        }

        .act-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: .85rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all .2s;
            flex-shrink: 0;
        }

        .act-btn.edit {
            background: rgba(139, 92, 246, .2);
            color: var(--accent-light);
        }

        .act-btn.edit:hover {
            background: rgba(139, 92, 246, .4);
        }

        .act-btn.toggle-vis {
            background: rgba(255, 200, 50, .1);
            color: #fde68a;
        }

        .act-btn.toggle-vis:hover {
            background: rgba(255, 200, 50, .25);
        }

        .act-btn.del {
            background: rgba(239, 68, 68, .12);
            color: #fca5a5;
        }

        .act-btn.del:hover {
            background: rgba(239, 68, 68, .3);
        }

        .games-empty {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-muted);
            font-size: .9rem;
        }

        .games-empty .em-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: .4;
        }

        /* EDIT MODAL */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: rgba(0, 0, 0, .7);
            backdrop-filter: blur(6px);
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal-overlay.active {
            display: flex;
            animation: fadeIn .25s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .edit-modal {
            width: 100%;
            max-width: 560px;
            max-height: 90vh;
            overflow-y: auto;
            background: linear-gradient(145deg, rgba(25, 20, 45, .98), rgba(12, 10, 22, .98));
            border: 1px solid rgba(139, 92, 246, .25);
            border-radius: 20px;
            box-shadow: 0 40px 80px rgba(0, 0, 0, .6), 0 0 60px -20px rgba(139, 92, 246, .2);
            position: relative;
            animation: modalIn .35s cubic-bezier(.34, 1.56, .64, 1);
        }

        @keyframes modalIn {
            from {
                opacity: 0;
                transform: scale(.93) translateY(-16px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .edit-modal::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            border-radius: 20px 20px 0 0;
            background: linear-gradient(90deg, transparent, var(--accent-violet), var(--accent-light), transparent);
        }

        .modal-head {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem 1.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, .07);
        }

        .modal-head-title {
            display: flex;
            align-items: center;
            gap: .6rem;
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .modal-close-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 50%;
            background: rgba(255, 255, 255, .07);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background .2s, color .2s;
        }

        .modal-close-btn:hover {
            background: rgba(239, 68, 68, .25);
            color: #fca5a5;
        }

        .modal-content {
            padding: 1.5rem 1.75rem;
            display: flex;
            flex-direction: column;
            gap: .85rem;
        }

        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive */
        @media (max-width: 800px) {
            .admin-sidebar {
                width: 60px;
                padding: 1rem .5rem;
            }

            .sidebar-brand .brand-name,
            .sidebar-brand .brand-sub,
            .nav-item span:not(.ni-icon),
            .nav-item .ni-badge,
            .sidebar-footer span,
            .btn-logout span:not(:first-child),
            .btn-back-site span:not(:first-child) {
                display: none;
            }

            .admin-main {
                padding: 1.25rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .form-grid .span2 {
                grid-column: span 1;
            }
        }
    </style>
</head>

<body class="admin-page">

    <!-- TOAST CONTAINER -->
    <div id="toastContainer"></div>

    <!-- =================== LOGIN SCREEN =================== -->
    <div class="login-screen active" id="loginScreen">
        <div class="login-card" id="loginCard">
            <div class="login-logo">
                <div class="icon-wrap" id="loginIconWrap">üîê</div>
                <h1>NOVAPLAY ADMIN</h1>
                <p>Acc√®s s√©curis√© √† l'espace administrateur</p>
                <!-- Dots showing failed attempts (max 5) -->
                <div class="attempt-dots" id="attemptDots">
                    <div class="attempt-dot" id="dot0"></div>
                    <div class="attempt-dot" id="dot1"></div>
                    <div class="attempt-dot" id="dot2"></div>
                    <div class="attempt-dot" id="dot3"></div>
                    <div class="attempt-dot" id="dot4"></div>
                </div>
            </div>

            <!-- Lockout banner -->
            <div class="lockout-banner" id="lockoutBanner">
                <strong>üîí Trop de tentatives √©chou√©es</strong>
                Compte temporairement bloqu√©. R√©essaie dans :
                <div class="lockout-timer" id="lockoutTimer">‚Äî</div>
            </div>

            <form id="loginForm" autocomplete="off">
                <div class="field-group">
                    <label for="adminPassword">
                        <span>Mot de passe</span>
                        <span class="attempts-left-label" id="attemptsLeftLabel" style="display:none"></span>
                    </label>
                    <div class="field-input-wrap" id="passwordWrap">
                        <span class="fi-icon">üîë</span>
                        <input type="password" id="adminPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password"
                            required>
                        <button type="button" class="toggle-pass-btn" id="togglePassBtn" title="Afficher/masquer">
                            üëÅÔ∏è
                        </button>
                    </div>
                    <div class="field-hint" id="fieldHint"></div>
                </div>
                <button type="submit" class="btn-primary" id="loginBtn">
                    <div class="btn-spinner" id="loginSpinner"></div>
                    <span class="btn-text">Se connecter ‚Üí</span>
                </button>
            </form>
            <p
                style="text-align:center;margin-top:1.25rem;font-size:.8rem;color:var(--text-muted);position:relative;z-index:1;">
                <a href="index.html" style="color:var(--accent-light);text-decoration:none;">‚Üê Retour au site</a>
            </p>
        </div>
    </div>

    <!-- =================== ADMIN LAYOUT =================== -->
    <div class="admin-layout" id="adminLayout">
        <!-- SIDEBAR -->
        <aside class="admin-sidebar">
            <div class="sidebar-brand">
                <div class="brand-icon">üéÆ</div>
                <div>
                    <div class="brand-name">NovaPlay</div>
                    <div class="brand-sub">Admin Panel</div>
                </div>
            </div>
            <nav class="sidebar-nav">
                <button class="nav-item active" data-page="dashboard" onclick="showAdminPage('dashboard')">
                    <span class="ni-icon">üìä</span>
                    <span>Dashboard</span>
                </button>
                <button class="nav-item" data-page="add-game" onclick="showAdminPage('add-game')">
                    <span class="ni-icon">‚ûï</span>
                    <span>Ajouter un jeu</span>
                </button>
                <button class="nav-item" data-page="manage-games" onclick="showAdminPage('manage-games')">
                    <span class="ni-icon">üóÇÔ∏è</span>
                    <span>G√©rer les jeux</span>
                    <span class="ni-badge" id="navGameCount">0</span>
                </button>
            </nav>
            <div class="sidebar-footer">
                <a href="index.html" class="btn-back-site">
                    <span>üåê</span>
                    <span>Voir le site</span>
                </a>
                <button class="btn-logout" id="logoutBtn">
                    <span>üö™</span>
                    <span>D√©connexion</span>
                </button>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="admin-main">

            <!-- === DASHBOARD PAGE === -->
            <div id="page-dashboard" class="admin-page-content">
                <div class="page-hdr">
                    <div class="page-hdr-left">
                        <h2>Dashboard</h2>
                        <p>Vue d'ensemble de ta biblioth√®que de jeux</p>
                    </div>
                </div>
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card"
                        style="--stat-color:var(--accent-violet);--stat-bg:rgba(139,92,246,.12);--stat-border:rgba(139,92,246,.25)">
                        <div class="stat-icon">üéÆ</div>
                        <div class="stat-info">
                            <div class="stat-val" id="statTotal">‚Äì</div>
                            <div class="stat-lbl">Total jeux</div>
                        </div>
                    </div>
                    <div class="stat-card"
                        style="--stat-color:#67e8f9;--stat-bg:rgba(6,182,212,.1);--stat-border:rgba(6,182,212,.2)">
                        <div class="stat-icon">üë§</div>
                        <div class="stat-info">
                            <div class="stat-val" id="statSolo">‚Äì</div>
                            <div class="stat-lbl">Solo</div>
                        </div>
                    </div>
                    <div class="stat-card"
                        style="--stat-color:var(--accent-light);--stat-bg:rgba(167,139,250,.1);--stat-border:rgba(167,139,250,.2)">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-info">
                            <div class="stat-val" id="statMulti">‚Äì</div>
                            <div class="stat-lbl">Multijoueur</div>
                        </div>
                    </div>
                    <div class="stat-card"
                        style="--stat-color:#86efac;--stat-bg:rgba(34,197,94,.08);--stat-border:rgba(34,197,94,.18)">
                        <div class="stat-icon">‚ö°</div>
                        <div class="stat-info">
                            <div class="stat-val" id="statModal">‚Äì</div>
                            <div class="stat-lbl">Avec modal</div>
                        </div>
                    </div>
                </div>

                <div class="admin-panel">
                    <div class="panel-hdr">
                        <div class="panel-hdr-title"><span class="ph-icon">üïê</span>Derniers jeux ajout√©s</div>
                    </div>
                    <div class="panel-body">
                        <div class="games-table" id="recentGamesList">
                            <div class="games-empty">
                                <div class="em-icon">‚è≥</div>Chargement‚Ä¶
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- === ADD GAME PAGE === -->
            <div id="page-add-game" class="admin-page-content" style="display:none">
                <div class="page-hdr">
                    <div class="page-hdr-left">
                        <h2>Ajouter un jeu</h2>
                        <p>Remplis le formulaire pour ajouter un jeu √† la biblioth√®que</p>
                    </div>
                </div>
                <div class="admin-panel">
                    <div class="panel-hdr">
                        <div class="panel-hdr-title"><span class="ph-icon">üìù</span>Informations du jeu</div>
                    </div>
                    <div class="panel-body">
                        <form id="addGameForm">
                            <div class="form-grid">
                                <div class="form-field span2">
                                    <label>Titre du jeu *</label>
                                    <input type="text" name="title" placeholder="Ex: Cyberpunk 2077" required>
                                </div>
                                <div class="form-field">
                                    <label>URL de l'image *</label>
                                    <input type="url" name="image" placeholder="https://..." required>
                                    <span class="hint">Recommand√© : 616√ó353 (capsule Steam)</span>
                                </div>
                                <div class="form-field">
                                    <label>Lien de t√©l√©chargement *</label>
                                    <input type="url" name="link" placeholder="https://..." required>
                                </div>
                                <div class="form-field">
                                    <label>Mode *</label>
                                    <select name="mode" required>
                                        <option value="solo">Solo</option>
                                        <option value="multiplayer">Multijoueur</option>
                                    </select>
                                </div>
                            </div>
                            <div style="margin-top:1.25rem">
                                <label class="toggle-row" for="hasModalAdd">
                                    <input type="checkbox" id="hasModalAdd" name="hasModal">
                                    <span class="toggle-knob"></span>
                                    <span class="toggle-label">üìñ Ajouter des instructions d'installation (modal)</span>
                                </label>
                            </div>
                            <div class="optional-fields" id="addModalFields">
                                <div class="form-field">
                                    <label>ID du modal (sans espaces)</label>
                                    <input type="text" name="modalId" placeholder="mon-jeu">
                                </div>
                                <div class="form-field">
                                    <label>Titre du modal</label>
                                    <input type="text" name="modalTitle" placeholder="Comment installer ?">
                                </div>
                                <div class="form-field">
                                    <label>Contenu HTML du modal</label>
                                    <textarea name="modalContent" placeholder="<ul><li>√âtape 1</li></ul>..."></textarea>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn-submit">‚ûï Ajouter le jeu</button>
                                <button type="reset" class="btn-ghost">R√©initialiser</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- === MANAGE GAMES PAGE === -->
            <div id="page-manage-games" class="admin-page-content" style="display:none">
                <div class="page-hdr">
                    <div class="page-hdr-left">
                        <h2>G√©rer les jeux</h2>
                        <p id="manageSubtitle">Chargement‚Ä¶</p>
                    </div>
                    <button class="btn-submit" style="padding:.65rem 1.25rem;font-size:.82rem;" onclick="loadGames()">üîÑ
                        Actualiser</button>
                </div>

                <div class="admin-panel">
                    <div class="panel-hdr">
                        <div class="panel-hdr-title"><span class="ph-icon">üóÇÔ∏è</span>Biblioth√®que</div>
                    </div>
                    <div class="panel-body">
                        <div class="games-toolbar">
                            <div class="search-wrap">
                                <span class="s-icon">üîç</span>
                                <input type="text" class="search-admin" id="manageSearch" placeholder="Rechercher‚Ä¶"
                                    oninput="filterGames()">
                            </div>
                            <button class="filter-pill active" data-filter="all"
                                onclick="setFilter('all',this)">Tous</button>
                            <button class="filter-pill" data-filter="solo"
                                onclick="setFilter('solo',this)">Solo</button>
                            <button class="filter-pill" data-filter="multiplayer"
                                onclick="setFilter('multiplayer',this)">Multi</button>
                        </div>
                        <div class="games-table" id="manageGamesList">
                            <div class="games-empty">
                                <div class="em-icon">‚è≥</div>Chargement‚Ä¶
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- =================== EDIT MODAL =================== -->
    <div class="modal-overlay" id="editModalOverlay">
        <div class="edit-modal">
            <div class="modal-head">
                <div class="modal-head-title">‚úèÔ∏è Modifier le jeu</div>
                <button class="modal-close-btn" onclick="closeEditModal()">√ó</button>
            </div>
            <div class="modal-content">
                <form id="editGameForm">
                    <input type="hidden" id="editIdx">
                    <div class="form-grid">
                        <div class="form-field span2">
                            <label>Titre *</label>
                            <input type="text" id="eTitle" placeholder="Titre du jeu" required>
                        </div>
                        <div class="form-field">
                            <label>URL image *</label>
                            <input type="url" id="eImage" placeholder="https://..." required>
                        </div>
                        <div class="form-field">
                            <label>Lien download *</label>
                            <input type="url" id="eLink" placeholder="https://..." required>
                        </div>
                        <div class="form-field">
                            <label>Mode *</label>
                            <select id="eMode">
                                <option value="solo">Solo</option>
                                <option value="multiplayer">Multijoueur</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-top:1rem">
                        <label class="toggle-row" for="eHasModal">
                            <input type="checkbox" id="eHasModal">
                            <span class="toggle-knob"></span>
                            <span class="toggle-label">üìñ Instructions d'installation</span>
                        </label>
                    </div>
                    <div class="optional-fields" id="eModalFields">
                        <div class="form-field">
                            <label>ID modal</label>
                            <input type="text" id="eModalId" placeholder="mon-jeu">
                        </div>
                        <div class="form-field">
                            <label>Titre modal</label>
                            <input type="text" id="eModalTitle" placeholder="Comment installer ?">
                        </div>
                        <div class="form-field">
                            <label>Contenu HTML</label>
                            <textarea id="eModalContent" placeholder="<ul><li>√âtape 1</li></ul>"></textarea>
                        </div>
                    </div>
                    <div class="form-actions" style="margin-top:1.25rem">
                        <button type="submit" class="btn-submit">üíæ Enregistrer</button>
                        <button type="button" class="btn-ghost" onclick="closeEditModal()">Annuler</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        const LOGIN_KEY = 'adminLoggedIn';
        const PASS_KEY = 'adminPass';
        const SESSION_EXPIRES_KEY = 'adminSessionExpires';
        const ATTEMPTS_KEY = 'adminFailedAttempts';
        const LOCKOUT_UNTIL_KEY = 'adminLockoutUntil';
        const MAX_ATTEMPTS = 5;
        const LOCKOUT_DURATION_MS = 3 * 60 * 1000; // 3 minutes
        const SESSION_DURATION_MS = 4 * 60 * 60 * 1000; // 4 hours

        let allGames = [];
        let activeFilter = 'all';
        let lockoutInterval = null;

        /* ========== TOAST ========== */
        function toast(msg, type = 'info') {
            const icons = { success: '‚úÖ', error: '‚ùå', info: '‚ÑπÔ∏è' };
            const t = document.createElement('div');
            t.className = 'toast ' + type;
            t.innerHTML = `<span class="toast-icon">${icons[type]}</span><span>${msg}</span>`;
            document.getElementById('toastContainer').appendChild(t);
            setTimeout(() => { t.classList.add('hide'); setTimeout(() => t.remove(), 300); }, 3500);
        }

        /* ========== AUTH HELPERS ========== */
        function isLoggedIn() {
            if (sessionStorage.getItem(LOGIN_KEY) !== '1') return false;
            const expires = parseInt(sessionStorage.getItem(SESSION_EXPIRES_KEY) || '0', 10);
            if (Date.now() > expires) {
                // Session expired
                sessionStorage.removeItem(LOGIN_KEY);
                sessionStorage.removeItem(PASS_KEY);
                sessionStorage.removeItem(SESSION_EXPIRES_KEY);
                return false;
            }
            return true;
        }

        function getPass() { return sessionStorage.getItem(PASS_KEY); }

        function getFailedAttempts() {
            return parseInt(localStorage.getItem(ATTEMPTS_KEY) || '0', 10);
        }

        function incrementFailedAttempts() {
            const n = getFailedAttempts() + 1;
            localStorage.setItem(ATTEMPTS_KEY, String(n));
            return n;
        }

        function resetFailedAttempts() {
            localStorage.removeItem(ATTEMPTS_KEY);
            localStorage.removeItem(LOCKOUT_UNTIL_KEY);
        }

        function getLockoutUntil() {
            return parseInt(localStorage.getItem(LOCKOUT_UNTIL_KEY) || '0', 10);
        }

        function setLockout() {
            const until = Date.now() + LOCKOUT_DURATION_MS;
            localStorage.setItem(LOCKOUT_UNTIL_KEY, String(until));
            return until;
        }

        function isLockedOut() {
            return Date.now() < getLockoutUntil();
        }

        /* ========== UI HELPERS ========== */
        function updateAttemptDots(used) {
            for (let i = 0; i < MAX_ATTEMPTS; i++) {
                const dot = document.getElementById('dot' + i);
                if (!dot) continue;
                dot.classList.remove('used', 'last-used');
                if (i < used) {
                    dot.classList.add('used');
                    if (i === used - 1) dot.classList.add('last-used');
                }
            }
            // Show attempts left label when at least 1 attempt used
            const label = document.getElementById('attemptsLeftLabel');
            if (used > 0 && used < MAX_ATTEMPTS) {
                label.style.display = '';
                label.textContent = `${MAX_ATTEMPTS - used} essai${MAX_ATTEMPTS - used > 1 ? 's' : ''} restant${MAX_ATTEMPTS - used > 1 ? 's' : ''}`;
            } else {
                label.style.display = 'none';
            }
        }

        function shakeField() {
            const wrap = document.getElementById('passwordWrap');
            const input = document.getElementById('adminPassword');
            wrap.classList.remove('shake');
            input.classList.add('error');
            void wrap.offsetWidth; // reflow
            wrap.classList.add('shake');
            setTimeout(() => {
                wrap.classList.remove('shake');
                input.classList.remove('error');
            }, 600);
        }

        function setFieldHint(msg, type) {
            const h = document.getElementById('fieldHint');
            h.textContent = msg;
            h.className = 'field-hint ' + (type || '');
        }

        function setBtnLoading(loading) {
            const btn = document.getElementById('loginBtn');
            const spinner = document.getElementById('loginSpinner');
            if (loading) {
                btn.classList.add('loading');
                btn.disabled = true;
                spinner.style.display = 'block';
                btn.querySelector('.btn-text').textContent = 'Connexion‚Ä¶';
            } else {
                btn.classList.remove('loading');
                btn.disabled = false;
                spinner.style.display = 'none';
                btn.querySelector('.btn-text').textContent = 'Se connecter ‚Üí';
            }
        }

        function startLockoutUI(until) {
            const card = document.getElementById('loginCard');
            const banner = document.getElementById('lockoutBanner');
            const timerEl = document.getElementById('lockoutTimer');
            const btn = document.getElementById('loginBtn');
            const input = document.getElementById('adminPassword');
            card.classList.add('locked');
            banner.classList.add('active');
            btn.disabled = true;
            input.disabled = true;

            // Fill all dots
            updateAttemptDots(MAX_ATTEMPTS);
            document.getElementById('attemptsLeftLabel').style.display = 'none';

            if (lockoutInterval) clearInterval(lockoutInterval);
            lockoutInterval = setInterval(() => {
                const remaining = Math.max(0, until - Date.now());
                const mins = Math.floor(remaining / 60000);
                const secs = Math.floor((remaining % 60000) / 1000);
                timerEl.textContent = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
                if (remaining <= 0) {
                    clearInterval(lockoutInterval);
                    lockoutInterval = null;
                    resetFailedAttempts();
                    card.classList.remove('locked');
                    banner.classList.remove('active');
                    btn.disabled = false;
                    input.disabled = false;
                    input.value = '';
                    setFieldHint('Tu peux r√©essayer maintenant.', 'ok');
                    updateAttemptDots(0);
                }
            }, 500);
        }

        /* ========== TOGGLE PASSWORD ========== */
        document.getElementById('togglePassBtn').addEventListener('click', function () {
            const input = document.getElementById('adminPassword');
            if (input.type === 'password') {
                input.type = 'text';
                this.textContent = 'üôà';
            } else {
                input.type = 'password';
                this.textContent = 'üëÅÔ∏è';
            }
        });

        /* ========== INIT AUTH STATE ========== */
        (function initAuth() {
            const attempts = getFailedAttempts();
            updateAttemptDots(attempts);

            if (isLockedOut()) {
                startLockoutUI(getLockoutUntil());
            }

            if (isLoggedIn()) { showAdmin(); }
        })();

        document.getElementById('loginForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            if (isLockedOut()) {
                shakeField();
                return;
            }

            const password = document.getElementById('adminPassword').value;
            setFieldHint('');
            setBtnLoading(true);

            try {
                const res = await fetch('/api/check-admin', {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });

                if (res.ok) {
                    resetFailedAttempts();
                    updateAttemptDots(0);
                    setFieldHint('');
                    // Store session with expiry
                    sessionStorage.setItem(LOGIN_KEY, '1');
                    sessionStorage.setItem(PASS_KEY, password);
                    sessionStorage.setItem(SESSION_EXPIRES_KEY, String(Date.now() + SESSION_DURATION_MS));
                    showAdmin();
                    toast('Connexion r√©ussie ! Bienvenue.', 'success');
                } else {
                    const d = await res.json().catch(() => ({}));
                    const attempts = incrementFailedAttempts();
                    updateAttemptDots(attempts);
                    shakeField();

                    if (attempts >= MAX_ATTEMPTS) {
                        const until = setLockout();
                        setFieldHint('Compte bloqu√© suite √† trop de tentatives.', 'err');
                        startLockoutUI(until);
                        toast('üîí Trop de tentatives. Bloqu√© 3 minutes.', 'error');
                    } else {
                        const remaining = MAX_ATTEMPTS - attempts;
                        const msg = d.error || 'Mot de passe incorrect';
                        setFieldHint(`${msg} (${remaining} essai${remaining > 1 ? 's' : ''} restant)`, 'err');
                        toast(msg, 'error');
                    }
                }
            } catch (err) {
                setFieldHint('Erreur r√©seau. V√©rifie ta connexion.', 'err');
                toast('Erreur r√©seau : ' + err.message, 'error');
            } finally {
                setBtnLoading(false);
            }
        });

        function showAdmin() {
            document.getElementById('loginScreen').classList.remove('active');
            document.getElementById('adminLayout').classList.add('active');
            loadGames();
        }

        document.getElementById('logoutBtn').addEventListener('click', function () {
            sessionStorage.removeItem(LOGIN_KEY);
            sessionStorage.removeItem(PASS_KEY);
            sessionStorage.removeItem(SESSION_EXPIRES_KEY);
            document.getElementById('adminLayout').classList.remove('active');
            document.getElementById('loginScreen').classList.add('active');
            // Reset form
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminPassword').type = 'password';
            document.getElementById('togglePassBtn').textContent = 'üëÅÔ∏è';
            setFieldHint('');
            toast('Vous avez √©t√© d√©connect√©.', 'info');
        });

        /* ========== NAVIGATION ========== */
        function showAdminPage(page) {
            document.querySelectorAll('.admin-page-content').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById('page-' + page).style.display = '';
            document.querySelector(`[data-page="${page}"]`).classList.add('active');
        }

        /* ========== LOAD GAMES ========== */
        async function loadGames() {
            try {
                const res = await fetch('/api/games', { cache: 'no-store' });
                allGames = res.ok ? await res.json() : [];
                if (!Array.isArray(allGames)) allGames = [];
            } catch (e) {
                allGames = [];
            }
            updateStats();
            renderManageList();
            renderRecentList();
            document.getElementById('navGameCount').textContent = allGames.length;
        }

        function updateStats() {
            const total = allGames.length;
            const solo = allGames.filter(g => (g.mode || 'solo') === 'solo').length;
            const multi = allGames.filter(g => g.mode === 'multiplayer').length;
            const modal = allGames.filter(g => g.hasModal).length;
            document.getElementById('statTotal').textContent = total;
            document.getElementById('statSolo').textContent = solo;
            document.getElementById('statMulti').textContent = multi;
            document.getElementById('statModal').textContent = modal;
            document.getElementById('manageSubtitle').textContent = `${total} jeu${total !== 1 ? 'x' : ''} dans la biblioth√®que`;
        }

        function escHtml(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }

        function gameRowHTML(g, i) {
            const mode = g.mode || 'solo';
            const isMulti = mode === 'multiplayer';
            const isHid = !!g.hidden;
            return `
        <div class="game-row ${isHid ? 'hidden-game' : ''}" data-index="${i}" data-filter="${mode}" data-search="${(g.title + ' ' + mode).toLowerCase()}">
            ${g.image
                    ? `<img src="${escHtml(g.image)}" alt="" class="game-thumb" onerror="this.style.display='none';">`
                    : `<div class="game-thumb-placeholder">üéÆ</div>`}
            <div class="game-info">
                <div class="g-title">${escHtml(g.title)}</div>
                <div class="g-meta">
                    <span class="g-badge ${mode}">${isMulti ? 'üë• Multi' : 'üë§ Solo'}</span>
                    ${g.hasModal ? '<span class="g-badge has-modal">üìñ Modal</span>' : ''}
                    ${isHid ? '<span class="g-badge hidden">üôà Masqu√©</span>' : ''}
                </div>
            </div>
            <div class="game-row-actions">
                <button class="act-btn edit" title="Modifier" onclick="openEditModal(${i})">‚úèÔ∏è</button>
                <button class="act-btn toggle-vis" title="${isHid ? 'Afficher' : 'Masquer'}" onclick="toggleVisibility(${i})">${isHid ? 'üëÅÔ∏è' : 'üôà'}</button>
                <button class="act-btn del" title="Supprimer" onclick="deleteGame(${i}, '${escHtml(g.title).replace(/'/g, "\\'")}')">üóëÔ∏è</button>
            </div>
        </div>`;
        }

        function renderManageList() {
            const el = document.getElementById('manageGamesList');
            if (!allGames.length) {
                el.innerHTML = '<div class="games-empty"><div class="em-icon">üéÆ</div>Aucun jeu pour l\'instant.</div>';
                return;
            }
            el.innerHTML = allGames.map((g, i) => gameRowHTML(g, i)).join('');
            filterGames();
        }

        function renderRecentList() {
            const el = document.getElementById('recentGamesList');
            const recent = [...allGames].slice(-5).reverse();
            if (!recent.length) {
                el.innerHTML = '<div class="games-empty"><div class="em-icon">üéÆ</div>Aucun jeu.</div>';
                return;
            }
            el.innerHTML = recent.map((g, idx) => {
                const realIdx = allGames.length - 1 - idx;
                return gameRowHTML(g, realIdx);
            }).join('');
        }

        /* ========== FILTER / SEARCH ========== */
        function setFilter(f, btn) {
            activeFilter = f;
            document.querySelectorAll('.filter-pill').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            filterGames();
        }

        function filterGames() {
            const q = (document.getElementById('manageSearch')?.value || '').trim().toLowerCase();
            document.querySelectorAll('#manageGamesList .game-row').forEach(row => {
                const matchQ = !q || (row.dataset.search || '').includes(q);
                const matchF = activeFilter === 'all' || row.dataset.filter === activeFilter;
                row.style.display = (matchQ && matchF) ? '' : 'none';
            });
        }

        /* ========== ADD GAME ========== */
        document.getElementById('hasModalAdd').addEventListener('change', function () {
            document.getElementById('addModalFields').classList.toggle('visible', this.checked);
        });

        document.getElementById('addGameForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const fd = new FormData(this);
            const game = {
                title: fd.get('title'),
                image: fd.get('image'),
                link: fd.get('link'),
                mode: fd.get('mode')
            };
            if (fd.get('hasModal') === 'on') {
                game.hasModal = true;
                game.modalId = fd.get('modalId') || game.title.toLowerCase().replace(/\s+/g, '-');
                game.modalTitle = fd.get('modalTitle') || 'Installation';
                game.modalContent = fd.get('modalContent') || '';
            }
            const adminPassword = getPass();
            const btn = this.querySelector('button[type=submit]');
            btn.textContent = '‚è≥ Ajout‚Ä¶'; btn.disabled = true;
            try {
                const res = await fetch('/api/add-game', {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ adminPassword, game })
                });
                const d = await res.json().catch(() => ({}));
                if (res.ok) {
                    toast(`‚ú® "${game.title}" ajout√© !`, 'success');
                    this.reset();
                    document.getElementById('addModalFields').classList.remove('visible');
                    await loadGames();
                    showAdminPage('manage-games');
                } else {
                    toast(d.error || 'Erreur ' + res.status, 'error');
                }
            } catch (err) {
                toast('Erreur r√©seau : ' + err.message, 'error');
            } finally {
                btn.textContent = '‚ûï Ajouter le jeu'; btn.disabled = false;
            }
        });

        /* ========== EDIT MODAL ========== */
        function openEditModal(i) {
            const g = allGames[i];
            if (!g) return;
            document.getElementById('editIdx').value = i;
            document.getElementById('eTitle').value = g.title || '';
            document.getElementById('eImage').value = g.image || '';
            document.getElementById('eLink').value = g.link || '';
            document.getElementById('eMode').value = g.mode === 'multiplayer' ? 'multiplayer' : 'solo';
            document.getElementById('eHasModal').checked = !!g.hasModal;
            document.getElementById('eModalId').value = g.modalId || '';
            document.getElementById('eModalTitle').value = g.modalTitle || '';
            document.getElementById('eModalContent').value = g.modalContent || '';
            document.getElementById('eModalFields').classList.toggle('visible', !!g.hasModal);
            document.getElementById('editModalOverlay').classList.add('active');
        }
        function closeEditModal() {
            document.getElementById('editModalOverlay').classList.remove('active');
        }
        document.getElementById('editModalOverlay').addEventListener('click', function (e) {
            if (e.target === this) closeEditModal();
        });
        document.getElementById('eHasModal').addEventListener('change', function () {
            document.getElementById('eModalFields').classList.toggle('visible', this.checked);
        });

        document.getElementById('editGameForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const i = parseInt(document.getElementById('editIdx').value, 10);
            const game = {
                title: document.getElementById('eTitle').value.trim(),
                image: document.getElementById('eImage').value.trim(),
                link: document.getElementById('eLink').value.trim(),
                mode: document.getElementById('eMode').value
            };
            if (document.getElementById('eHasModal').checked) {
                game.hasModal = true;
                game.modalId = document.getElementById('eModalId').value.trim().replace(/\s+/g, '-') || game.title.toLowerCase().replace(/\s+/g, '-');
                game.modalTitle = document.getElementById('eModalTitle').value.trim() || 'Installation';
                game.modalContent = document.getElementById('eModalContent').value.trim();
            }
            const adminPassword = getPass();
            const btn = this.querySelector('[type=submit]');
            btn.textContent = '‚è≥ Sauvegarde‚Ä¶'; btn.disabled = true;
            try {
                const res = await fetch('/api/update-game', {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ adminPassword, index: i, game })
                });
                const d = await res.json().catch(() => ({}));
                if (res.ok) {
                    toast('Jeu mis √† jour avec succ√®s !', 'success');
                    closeEditModal();
                    await loadGames();
                } else {
                    toast(d.error || 'Erreur ' + res.status, 'error');
                }
            } catch (err) {
                toast('Erreur r√©seau : ' + err.message, 'error');
            } finally {
                btn.textContent = 'üíæ Enregistrer'; btn.disabled = false;
            }
        });

        /* ========== DELETE / VISIBILITY ========== */
        async function deleteGame(i, title) {
            if (!confirm(`Supprimer "${title}" d√©finitivement ?`)) return;
            const adminPassword = getPass();
            try {
                const res = await fetch('/api/delete-game', {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ adminPassword, index: i })
                });
                const d = await res.json().catch(() => ({}));
                if (res.ok) {
                    toast(`"${title}" supprim√©.`, 'success');
                    await loadGames();
                } else {
                    toast(d.error || 'Erreur ' + res.status, 'error');
                }
            } catch (err) {
                toast('Erreur r√©seau : ' + err.message, 'error');
            }
        }

        async function toggleVisibility(i) {
            const g = allGames[i];
            if (!g) return;
            const updated = { ...g, hidden: !g.hidden };
            const adminPassword = getPass();
            try {
                const res = await fetch('/api/update-game', {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ adminPassword, index: i, game: updated })
                });
                if (res.ok) {
                    toast(updated.hidden ? `"${g.title}" masqu√©.` : `"${g.title}" affich√©.`, 'info');
                    await loadGames();
                } else {
                    const d = await res.json().catch(() => ({}));
                    toast(d.error || 'Erreur', 'error');
                }
            } catch (err) {
                toast('Erreur r√©seau : ' + err.message, 'error');
            }
        }
    </script>
</body>

</html>